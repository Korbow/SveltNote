import { useEffect, useRef } from "react";
import gsap from "gsap";
import { MotionPathPlugin } from "gsap/MotionPathPlugin";
import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";


import '../styles/Schema.css'


gsap.registerPlugin(MotionPathPlugin,  DrawSVGPlugin);

function RocketCSS() {
  const rocketRef = useRef(null);


  useEffect(() => {
    const rocket = rocketRef.current;


    const tl = gsap.timeline({ repeat: -1 }); // boucle infinie

    // Animation principale : fus√©e qui avance horizontalement
    tl.to(rocket, {
      duration: 1.5,
      x: 10,
      keyframes: [
        { y: -3, duration: 0.1 },
        { y:  3, duration: 0.1 },
        { y: -2, duration: 0.1 },
        { y:  2, duration: 0.1 },
        { y: -1, duration: 0.1 },
        { y:  1, duration: 0.1 },
      ],
      ease: "power1.inOut",
    });

    tl.to(rocket, {
      duration: 1.8,
      x: 245, // distance horizontale
      ease: "expo.in",
    });

    tl.to(rocket, {
      duration: 1,
      x: 245.1, // distance horizontale
      ease: "power1.inOut",
    });

    
  }, []);

  return (
    <div className="pathRocket">
      <svg ref={rocketRef}
        
        viewBox="0 0 297.115 297.115"
        width="50"
        height="50"
      >
        <g  className="rocket">
          <path
            d="M218.727,173.136v-40.252c0-33.637-11.331-67.002-32.769-96.488c-16.145-22.208-32.224-34.387-32.9-34.895
              c-2.666-2.002-6.336-2.002-9.002,0c-0.677,0.508-16.755,12.687-32.9,34.895c-21.438,29.486-32.768,62.852-32.768,96.488v40.252
              c-17.838,3.506-31.338,19.259-31.338,38.112v78.365c0,3.305,2.164,6.221,5.327,7.179c0.718,0.217,1.449,0.322,2.172,0.322
              c2.462,0,4.825-1.216,6.242-3.342l31.338-47.02c0.82-1.231,1.259-2.679,1.259-4.159v-7.929h32.001v21.227
              c0,11.297,12.939,31.823,16.905,37.846c1.388,2.106,3.741,3.375,6.264,3.375c2.522,0,4.876-1.269,6.264-3.375
              c3.966-6.022,16.905-26.549,16.905-37.846v-21.227h32.001v7.929c0,1.48,0.438,2.928,1.259,4.159l31.338,47.02
              c1.417,2.126,3.78,3.342,6.242,3.342c0.723,0,1.454-0.105,2.172-0.322c3.163-0.958,5.327-3.874,5.327-7.179v-78.365
              C250.065,192.395,236.565,176.642,218.727,173.136z"
            fill="black"
            stroke="black"
          />
        </g>
        
      </svg>

    </div>
  );
}



function DrawSVGAnimator({ children, duration = 2, delay = 0.3 }) {
  const wrapperRef = useRef(null);

  useEffect(() => {
    const svg = wrapperRef.current?.querySelector("svg");
    if (!svg) return;

    const paths = svg.querySelectorAll("path, line, polyline");
    const polygons = svg.querySelectorAll("polygon");

    const tl = gsap.timeline({ repeat: -1, repeatDelay: 0.4 });

    // --- FIX : Convertir les PATH en outline ---
    paths.forEach((el) => {
      gsap.set(el, {
        stroke: el.getAttribute("stroke") || "black",
        strokeWidth: el.getAttribute("stroke-width") || 10,
        fill: "none",
      });
    });
    

    // Animation des PATH
    paths.forEach((el, i) => {
      tl.fromTo(
        el,
        { drawSVG: "0% 0%" },
        { drawSVG: "0% 100%", duration, ease: "power1.inOut" },
        i * delay
      );
    });

    // Animation des POLYGONS (on les transforme en outline)
    polygons.forEach((el, i) => {
      gsap.set(el, {
        stroke: el.getAttribute("fill") || "black",
        fill: "none",
        strokeWidth: 3,
      });

      tl.fromTo(
        el,
        { drawSVG: "0% 0%" },
        { drawSVG: "0% 100%", duration: 0.7, ease: "power1.inOut" },
        paths.length * delay + i * delay
      );
    });

  }, [children, duration, delay]);

  return <div ref={wrapperRef}>{children}</div>;
}



function ArrowAnimation() {
  const arrowsRef = useRef([]);

  useEffect(() => {
    const tl = gsap.timeline({ repeat: -1 });

    arrowsRef.current.forEach((arrow, i) => {
      tl.fromTo(
        arrow,
        { opacity: 0 },
        { opacity: 1, duration: 0.3, ease: "power2.out" },
        i * 0.15
      );

      tl.to(
        arrow,
        { opacity: 0, duration: 0.2, ease: "power2.in" },
        "+=0.01"
      );
    });
  }, []);

  return (
    <svg width="100%" viewBox="0 0 200 80">
      {[0, 1, 2, 3, 4, 5].map((i) => (
        <path
        key={i}
        ref={(el) => (arrowsRef.current[i] = el)}
        d="M0 0 L15 0 L30 15 L15 30 L0 30 L15 15 Z"
        fill={i === 5 ? '#bfbfbf' : 'black'}
        transform={`translate(${i * 40}, 0)`}
        opacity="0"
      />
      ))}
    </svg>
  );
}

function PaperPlane() {
  const svgRef = useRef(null);
  const flightPathRef = useRef(null);
  const trailRef = useRef(null);
  const planeRef = useRef(null);

  useEffect(() => {
    const path = flightPathRef.current;
    const trail = trailRef.current;
    const plane = planeRef.current;
  
    const length = path.getTotalLength();
  
    const TLENGTH = 0.10; // longueur du trail (10%)
    const DELAY = 0.15;   // delay du trail
  
    // fonction de reset du trail
    const resetTrail = () => {
      gsap.set(trail, {
        strokeDasharray: length,
        strokeDashoffset: length,
        drawSVG: "0% 0%"
      });
    };
  
    resetTrail();
  
    const tl = gsap.timeline({
      defaults: { ease: "none" },
      repeat: -1,          // üîÅ boucle infinie
      onRepeat: resetTrail // üîÑ reset du trail √† chaque boucle
    });
  
    tl.to(plane, {
      duration: 3,
      motionPath: {
        path,
        align: path,
        autoRotate: true,
        alignOrigin: [0.5, 0.5],
      },
      onUpdate() {
        const p = this.progress();
        const delayedP = Math.max(0, p - DELAY / 3);
  
        const head = delayedP * length;
        const tail = Math.max(0, head - length * TLENGTH);
  
        gsap.set(trail, { drawSVG: `${tail}px ${head}px` });
      }
    });
  
  }, []);

  return (
    <svg viewBox="200 150 200 270" width= "550" height="230">
  {/* TRAJECTOIRE INVISIBLE */}
  
  <path
    ref={flightPathRef}
    d="m39.92424,388c0,-0.5 66.25,-41.84849 95.42424,-48.29924c29.17424,-6.45076 65.80303,-1.56439 79.0303,-22.54924c13.22727,-20.98485 6.57339,-36.24953 57.8492,-52.2371c51.27581,-15.98757 62.20194,5.72384 89.06369,-15.9684c26.86174,-21.69224 15.95833,-33.60511 2.26136,-55.94602c-13.69697,-22.34091 -50.67235,-11.18561 -66.86364,0.37974c-16.19129,11.56534 -28.43182,53.49905 17.7197,66.83239c46.15152,13.33333 272.24243,-33.09091 252.9697,29.72727c-19.27273,62.81818 129.24243,-3.51515 136.24243,-7.51515"
    fill="none"
    stroke="none"
    strokeWidth={4}
  />

  {/* TRACE BLANCHE (anim√©e en dashoffset) */}
  <path id="#pathAvion"
    ref={trailRef}
    d="m39.92424,388c0,-0.5 66.25,-41.84849 95.42424,-48.29924c29.17424,-6.45076 65.80303,-1.56439 79.0303,-22.54924c13.22727,-20.98485 6.57339,-36.24953 57.8492,-52.2371c51.27581,-15.98757 62.20194,5.72384 89.06369,-15.9684c26.86174,-21.69224 15.95833,-33.60511 2.26136,-55.94602c-13.69697,-22.34091 -50.67235,-11.18561 -66.86364,0.37974c-16.19129,11.56534 -28.43182,53.49905 17.7197,66.83239c46.15152,13.33333 272.24243,-33.09091 252.9697,29.72727c-19.27273,62.81818 129.24243,-3.51515 136.24243,-7.51515"
    fill="none"
    stroke="black"
    strokeWidth={4}
  />

  {/* AVION / GROUPE */}
  <g ref={planeRef} width= "30px" >
    {/* Ici ton avion, ou un polygon simple */}
    <svg id="corectpath"  fill="#000000" height="90px" width="90px" version="1.1" viewBox="0 0 60.062 60.062" >
    <path d="M60.046,11.196c0.004-0.024,0.011-0.048,0.013-0.072c0.007-0.074-0.001-0.149-0.01-0.224  c-0.002-0.019,0.001-0.037-0.002-0.056c-0.018-0.099-0.051-0.196-0.1-0.289c-0.008-0.016-0.019-0.031-0.028-0.047  c-0.002-0.002-0.002-0.005-0.003-0.008c-0.001-0.002-0.004-0.003-0.005-0.006c-0.007-0.011-0.013-0.023-0.02-0.033  c-0.062-0.091-0.137-0.166-0.221-0.23c-0.019-0.014-0.041-0.022-0.061-0.035c-0.074-0.049-0.152-0.089-0.236-0.116  c-0.037-0.012-0.074-0.018-0.112-0.025c-0.073-0.015-0.146-0.022-0.222-0.02c-0.04,0.001-0.078,0.003-0.118,0.009  c-0.026,0.004-0.051,0-0.077,0.006L0.798,22.046c-0.413,0.086-0.729,0.421-0.788,0.839s0.15,0.828,0.523,1.025l16.632,8.773  l2.917,16.187c-0.002,0.012,0.001,0.025,0,0.037c-0.01,0.08-0.011,0.158-0.001,0.237c0.005,0.04,0.01,0.078,0.02,0.117  c0.023,0.095,0.06,0.184,0.11,0.268c0.01,0.016,0.01,0.035,0.021,0.051c0.003,0.005,0.008,0.009,0.012,0.013  c0.013,0.019,0.031,0.034,0.046,0.053c0.047,0.058,0.096,0.111,0.152,0.156c0.009,0.007,0.015,0.018,0.025,0.025  c0.015,0.011,0.032,0.014,0.047,0.024c0.061,0.04,0.124,0.073,0.191,0.099c0.027,0.01,0.052,0.022,0.08,0.03  c0.09,0.026,0.183,0.044,0.277,0.044c0.001,0,0.002,0,0.003,0h0c0,0,0,0,0,0c0.004,0,0.008-0.002,0.012-0.002  c0.017,0.001,0.034,0.002,0.051,0.002c0.277,0,0.527-0.124,0.712-0.315l11.079-7.386l11.6,7.54c0.164,0.106,0.354,0.161,0.545,0.161  c0.105,0,0.212-0.017,0.315-0.051c0.288-0.096,0.518-0.318,0.623-0.604l13.996-37.989c0.013-0.034,0.024-0.069,0.033-0.105  c0.004-0.015,0.005-0.03,0.008-0.044C60.042,11.22,60.044,11.208,60.046,11.196z M48.464,17.579L24.471,35.22  c-0.039,0.029-0.07,0.065-0.104,0.099c-0.013,0.012-0.026,0.022-0.037,0.035c-0.021,0.023-0.04,0.046-0.059,0.071  c-0.018,0.024-0.032,0.049-0.048,0.074c-0.037,0.06-0.068,0.122-0.092,0.188c-0.005,0.013-0.013,0.023-0.017,0.036  c-0.001,0.004-0.005,0.006-0.006,0.01l-2.75,8.937l-2.179-12.091L48.464,17.579z M22.908,46.594l2.726-9.004l4.244,2.759  l1.214,0.789l-4.124,2.749L22.908,46.594z M52.044,13.498L18.071,30.899l-14.14-7.458L52.044,13.498z M44.559,47.504L29.154,37.492  l-2.333-1.517l30.154-22.172L44.559,47.504z"/>
    </svg>
  </g>
</svg>
  );
}
/*

<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600">
 <g id="Layer_1">
  <title>Layer 1</title>
  <path id="svg_1" d="m39.92424,388c0,-0.5 66.25,-41.84849 95.42424,-48.29924c29.17424,-6.45076 65.80303,-1.56439 79.0303,-22.54924c13.22727,-20.98485 6.57339,-36.24953 57.8492,-52.2371c51.27581,-15.98757 62.20194,5.72384 89.06369,-15.9684c26.86174,-21.69224 15.95833,-33.60511 2.26136,-55.94602c-13.69697,-22.34091 -50.67235,-11.18561 -66.86364,0.37974c-16.19129,11.56534 -28.43182,53.49905 17.7197,66.83239c46.15152,13.33333 272.24243,-33.09091 252.9697,29.72727c-19.27273,62.81818 129.24243,-3.51515 136.24243,-7.51515" opacity="NaN" stroke="#000" fill="none"/>
 </g>
</svg>

*/


function Schema() {
  

  return (
    <>
        <div className="Schema">
            <div className="RectangleView">
              <div class="step step1">
                <h5>IMAGINE</h5> 
                <p>
                  Get the idea
                </p>
              </div>
              <div class="path path1">
              <PaperPlane></PaperPlane>
              </div>
              <div class="step step2">
                <h5>PLAN</h5> 
                <p>
                  Structure your idea, your intentions
              </p>
              </div>
              <div class="path path2">
              <ArrowAnimation></ArrowAnimation>
              
              
              </div>
              <div class="step step3">
                <h5>ANALYZE</h5> 
                <p>
                  Study and calculate your idea
                </p>
              </div>
              <div class="path path3">
              <DrawSVGAnimator duration={2} delay={0}>
                <svg  fill="#000000" height="70px" width="70px"  viewBox="0 0 512 512" >

                <path d="M11.529,432.477h-0.635C4.877,432.477,0,437.354,0,443.37c0,6.017,4.877,10.894,10.894,10.894h0.635     c6.017,0,10.894-4.877,10.894-10.894C22.422,437.354,17.545,432.477,11.529,432.477z"/>
                <path d="M501.106,288.681h-4.357V68.63c0-0.052-0.008-0.09-0.01-0.139c-0.028-2.236-0.734-4.471-2.147-6.368     c-3.038-4.079-8.495-5.511-13.145-3.453L181.327,191.51c-3.942,1.745-6.485,5.651-6.485,9.961v25.116h-16.34     c-6.017,0-10.894,4.877-10.894,10.894v37.038h-34.497v-59.915c0-6.017-4.877-10.894-10.894-10.894H53.197     c-6.017,0-10.894,4.877-10.894,10.894v59.915h-6.354c-6.017,0-10.894,4.877-10.894,10.894s4.877,10.894,10.894,10.894h1.634     v38.128c0,6.017,4.877,10.894,10.894,10.894h87.149c6.017,0,10.894-4.877,10.894-10.894v-38.128h56.102v36.996l-20.826,99.174     H52.834c-6.017,0-10.894,4.877-10.894,10.894c0,6.017,4.877,10.894,10.894,10.894h317.549c6.015,0,10.894-4.877,10.894-10.894     c0-6.017-4.878-10.894-10.894-10.894h-37.999l-20.826-99.171v-43.873L474.962,98.154v190.527h-4.357     c-6.015,0-10.894,4.877-10.894,10.894s4.878,10.894,10.894,10.894h30.502c6.015,0,10.894-4.877,10.894-10.894     S507.122,288.681,501.106,288.681z M64.09,225.498h27.234v49.021H64.09V225.498z M124.732,323.541H59.37v-27.234h65.362V323.541z      M202.077,274.519h-32.681v-26.145h32.681V274.519z M246.196,432.477h-42.139l6.863-32.681h35.276V432.477z M246.196,378.009     h-30.7l6.863-32.681h23.837V378.009z M289.77,323.541h-65.362v-27.234h65.362V323.541z M291.82,345.328l6.863,32.681h-30.7     v-32.681H291.82z M267.983,432.477v-32.681h35.276l6.863,32.681H267.983z M295.643,274.519h-71.779v-37.038     c0-6.017-4.877-10.894-10.894-10.894h-16.34v-18.025L446.451,97.984L295.643,274.519z"/>

                  </svg>
                </DrawSVGAnimator>   
              </div>
              <div class="path path4">
              <DrawSVGAnimator duration={2} delay={0}>
                <svg
                  width="260"
                  height="240"
                  viewBox="0 0 260 240"
                  fill="none"
                  
                >
                  {/* Trait de la fl√®che */}
                  <path
                    d="M220 20 H40 V190"
                    stroke="black"
                    strokeWidth="3"
                    fill="none"
                  />

                  {/* Pointe de la fl√®che (vers le bas) */}
                  <polygon
                    points="40,205 30,190 50,190"
                    fill="black"
                  />
                </svg>
                </DrawSVGAnimator>
              </div>

              <div class="path path5">
              <DrawSVGAnimator duration={2} delay={0}>
              <svg  fill="#000000" height="60px" width="60px" version="1.1" id="Capa_1" viewBox="0 0 402.686 402.686">
                <g>
                  <path d="M15,193.754h96.605c8.271,0,15-6.729,15-15V148.67c0-8.271-6.729-15-15-15H15c-8.271,0-15,6.729-15,15v30.084   C0,187.025,6.729,193.754,15,193.754z"/>
                  <path d="M264.287,178.754V148.67c0-8.271-6.729-15-15-15h-96.605c-8.271,0-15,6.729-15,15v30.084c0,8.271,6.729,15,15,15h96.605   C257.558,193.754,264.287,187.025,264.287,178.754z"/>
                  <path d="M401.968,178.754V148.67c0-8.271-6.729-15-15-15h-96.605c-8.271,0-15,6.729-15,15v30.084c0,8.271,6.729,15,15,15h96.605   C395.239,193.754,401.968,187.025,401.968,178.754z"/>
                  <path d="M82.976,118.492h96.606c8.271,0,15-6.729,15-15V73.407c0-8.271-6.729-15-15-15H82.976c-8.271,0-15,6.729-15,15v30.085   C67.976,111.763,74.705,118.492,82.976,118.492z"/>
                  <path d="M222.104,118.492h96.605c8.271,0,15-6.729,15-15V73.407c0-8.271-6.729-15-15-15h-96.605c-8.271,0-15,6.729-15,15v30.085   C207.104,111.763,213.833,118.492,222.104,118.492z"/>
                  <path d="M15,118.492h26.302c8.271,0,15-6.729,15-15V73.407c0-8.271-6.729-15-15-15H15c-8.271,0-15,6.729-15,15v30.085   C0,111.763,6.729,118.492,15,118.492z"/>
                  <path d="M387.686,58.407h-26.301c-8.271,0-15,6.729-15,15.001v30.084c0,8.271,6.729,15,15,15h26.301c8.271,0,15-6.729,15-15V73.408   C402.686,65.136,395.957,58.407,387.686,58.407z"/>
                  <path d="M111.605,284.194H15c-8.271,0-15,6.729-15,15v30.085c0,8.271,6.729,15,15,15h96.605c8.271,0,15-6.729,15-15v-30.085   C126.605,290.923,119.877,284.194,111.605,284.194z"/>
                  <path d="M249.287,284.194h-96.605c-8.271,0-15,6.729-15,15v30.085c0,8.271,6.729,15,15,15h96.605c8.271,0,15-6.729,15-15v-30.085   C264.287,290.923,257.558,284.194,249.287,284.194z"/>
                  <path d="M386.968,284.194h-96.605c-8.271,0-15,6.729-15,15v30.085c0,8.271,6.729,15,15,15h96.605c8.271,0,15-6.729,15-15v-30.085   C401.968,290.923,395.239,284.194,386.968,284.194z"/>
                  <path d="M82.976,208.932c-8.271,0-15,6.729-15,15v30.085c0,8.271,6.729,15,15,15h96.606c8.271,0,15-6.729,15-15v-30.085   c0-8.271-6.729-15-15-15H82.976z"/>
                  <path d="M222.104,269.016h96.605c8.271,0,15-6.729,15-15v-30.085c0-8.271-6.729-15-15-15h-96.605c-8.271,0-15,6.729-15,15v30.085   C207.104,262.287,213.833,269.016,222.104,269.016z"/>
                  <path d="M15,269.016h26.302c8.271,0,15-6.729,15-15v-30.085c0-8.271-6.729-15-15-15H15c-8.271,0-15,6.729-15,15v30.085   C0,262.287,6.729,269.016,15,269.016z"/>
                  <path d="M387.686,208.932h-26.301c-8.271,0-15,6.729-15,15v30.085c0,8.271,6.729,15,15,15h26.301c8.271,0,15-6.729,15-15v-30.085   C402.686,215.661,395.957,208.932,387.686,208.932z"/>
                </g>
                </svg>
                </DrawSVGAnimator>
              </div>

              <div class="path path6">
              <DrawSVGAnimator duration={2} delay={0}>
              <svg height="60px" width="60px" viewBox="0 0 214.614 214.614" >
                <path  d="M64.071,145.308l-9.488,9.488c-3.521,3.521-8.203,5.461-13.184,5.461  c-1.628,0-3.251-0.214-4.824-0.635l-4.517-1.21c-2.588-0.694-4.609-2.715-5.303-5.304c-0.693-2.588,0.046-5.35,1.94-7.244  l11.138-11.138c0.806-0.805,0.806-2.166,0-2.971l-5.009-5.009c-0.524-0.525-1.156-0.604-1.485-0.604s-0.96,0.079-1.484,0.604  l-11.138,11.138c-1.896,1.896-4.658,2.635-7.245,1.941c-2.588-0.694-4.609-2.715-5.303-5.304l-1.21-4.515  c-1.719-6.414,0.131-13.314,4.825-18.009l9.486-9.487c3.522-3.521,8.205-5.461,13.185-5.461c1.628,0,3.251,0.214,4.824,0.635  l3.998,1.071l61.802-61.801l-1.071-3.998c-1.719-6.415,0.131-13.315,4.825-18.01l9.486-9.486C121.843,1.939,126.526,0,131.506,0  c1.627,0,3.25,0.214,4.823,0.635l4.517,1.21c2.588,0.694,4.609,2.715,5.303,5.304c0.693,2.588-0.046,5.35-1.94,7.244L133.07,25.531  c-0.806,0.805-0.806,2.166,0,2.971l5.009,5.008c0.525,0.525,1.156,0.604,1.485,0.604s0.961-0.079,1.486-0.604l11.137-11.137  c1.896-1.895,4.659-2.633,7.245-1.941c2.588,0.694,4.609,2.715,5.303,5.304l1.21,4.515c1.719,6.414-0.131,13.314-4.825,18.009  l-9.486,9.487c-3.522,3.521-8.205,5.461-13.186,5.461c-1.627,0-3.25-0.214-4.824-0.635l-3.998-1.071l-61.801,61.801l1.07,3.999  C70.614,133.713,68.766,140.613,64.071,145.308z M206.857,70.688c-1.631-2.497-4.378-3.987-7.348-3.987  c-1.218,0-2.406,0.25-3.529,0.742l-7.554,3.31c-1.074,0.356-2.084,0.961-2.939,1.816l-50.15,50.15  c-2.891-1.786-6.729-1.432-9.237,1.075l-3.871,3.871l-3.28-3.28c-2.929-2.929-7.677-2.929-10.607,0  c-2.484,2.484-2.853,6.275-1.123,9.157l-42.685,42.686c-5.54,5.542-5.54,14.558,0.001,20.1l14.126,14.126  c2.685,2.685,6.253,4.164,10.05,4.164c3.796,0,7.365-1.479,10.051-4.163l42.684-42.685c1.183,0.711,2.517,1.074,3.854,1.074  c1.919,0,3.839-0.732,5.304-2.197c2.929-2.929,2.929-7.678,0-10.606l-3.281-3.281l3.871-3.871c2.507-2.508,2.861-6.346,1.075-9.237  l50.151-50.151c0.803-0.803,1.401-1.774,1.767-2.829l3.356-7.661C208.736,76.284,208.481,73.173,206.857,70.688z"/>
              </svg>
              </DrawSVGAnimator>
              </div>

              

              <div class="step step4">
                <h5>BUILD</h5> 
                <p>
                  Start building and concretize your ideas
                </p>
              </div>

              <div class="path path7">
              <RocketCSS/>
              </div>

              <div class="step step5">
                <h5>LAUNCH</h5> 
                <p>
                 Publish your project to the world
                </p>
              </div>

            </div>

        </div>
    </>
  )
}

export default Schema
